import streamlit as st

# âœ… ëª¨í—˜ê°€ë³„ ëª¨ë˜ì–‘ ë°ì´í„° (Lv -> ëª¨ë˜ì–‘)
ëª¨ë˜ì–‘_DB = {
    "ìš©ì†Œë…€": {"100": 55125},
    "í”¼ê¸°": {"60": 9555, "90": 16990},
    "íŒë‹¤": {"60": 9555, "90": 15900},
    "ê³°": {"60": 12740},
    "ì˜¤ê³µ": {"2": 0},
    "ê°€ê°€ë¦°": {"2": 0},
    "ë ˆì˜¤ë‚˜ë¥´ë„": {"60": 15925},
    "ë¼íŒŒì—˜": {"60": 15925}
}

# âœ… ê³µìƒí•© ì¡°í•© ë°ì´í„°
ê³µìƒí•©_ì¡°í•© = [
    {
        "ì¡°í•©ëª…": "ì¡°í•©1",
        "ëª¨í—˜ê°€ë“¤": {"í”¼ê¸°": 60, "íŒë‹¤": 60, "ê³°": 60, "ì˜¤ê³µ": 0, "ê°€ê°€ë¦°": 0, "ë ˆì˜¤ë‚˜ë¥´ë„": 60, "ë¼íŒŒì—˜": 60},
        "ëª¨ë˜ì†Œëª¨ëŸ‰": 69070,
        "ê³µìƒí•©": 210
    },
    {
        "ì¡°í•©ëª…": "ì¡°í•©2",
        "ëª¨í—˜ê°€ë“¤": {"í”¼ê¸°": 90, "íŒë‹¤": 60, "ê³°": 60, "ì˜¤ê³µ": 0, "ê°€ê°€ë¦°": 0, "ë ˆì˜¤ë‚˜ë¥´ë„": 60, "ë¼íŒŒì—˜": 60},
        "ëª¨ë˜ì†Œëª¨ëŸ‰": 76510,
        "ê³µìƒí•©": 195
    },
    {
        "ì¡°í•©ëª…": "ì¡°í•©3",
        "ëª¨í—˜ê°€ë“¤": {"í”¼ê¸°": 60, "íŒë‹¤": 60, "ê³°": 60, "ì˜¤ê³µ": 0, "ê°€ê°€ë¦°": 0, "ë ˆì˜¤ë‚˜ë¥´ë„": 0, "ë¼íŒŒì—˜": 0},
        "ëª¨ë˜ì†Œëª¨ëŸ‰": 31850,
        "ê³µìƒí•©": 175
    }
]

ëª¨í—˜ê°€_ëª©ë¡ = ['í”¼ê¸°', 'íŒë‹¤', 'ê³°', 'ì˜¤ê³µ', 'ê°€ê°€ë¦°', 'ë ˆì˜¤ë‚˜ë¥´ë„', 'ë¼íŒŒì—˜']

st.title("ğŸ–ï¸ ëª¨í—˜ê°€ ëª¨ë˜ì–‘ ê³„ì‚°ê¸° â„ï¸")
st.markdown("""
- ëª¨í—˜ê°€ë¥¼ ì„ íƒí•˜ê³  ë ˆë²¨ì„ ì…ë ¥í•˜ë©´ ì¶”ì²œ ëª¨í—˜ê°€ Lvì´ ê³„ì‚°ë©ë‹ˆë‹¤.
- ìš©ì†Œë…€ëŠ” Lv 100 ê³ ì •ì…ë‹ˆë‹¤.
""")

ì‚¬ìš©ì_Lv = {}
ì´ëª¨ë˜ì–‘ = 0

st.subheader("1ï¸âƒ£ ëª¨í—˜ê°€ ì„ íƒ ë° ë ˆë²¨ ì…ë ¥")
cols = st.columns(4)
for i, ëª¨í—˜ê°€ in enumerate(ëª¨í—˜ê°€_ëª©ë¡):
    with cols[i % 4]:
        ì‚¬ìš© = st.checkbox(f"{ëª¨í—˜ê°€} ì‚¬ìš©", key=f"chk_{ëª¨í—˜ê°€}")
        if ì‚¬ìš©:
            lv = st.number_input(f"{ëª¨í—˜ê°€} Lv", min_value=2, max_value=100, step=1, key=f"lv_{ëª¨í—˜ê°€}")
        else:
            lv = 0
        ì‚¬ìš©ì_Lv[ëª¨í—˜ê°€] = lv

ì œì¶œ = st.button("ëª¨ë˜ì–‘ ê³„ì‚° ë° ìµœì  ì¡°í•© ì¶”ì²œ", use_container_width=True)

if ì œì¶œ:
    ì´ëª¨ë˜ì–‘ = ëª¨ë˜ì–‘_DB['ìš©ì†Œë…€']['100']
    for ëª¨í—˜ê°€, lv in ì‚¬ìš©ì_Lv.items():
        if lv > 0:
            ì´ëª¨ë˜ì–‘ += ëª¨ë˜ì–‘_DB[ëª¨í—˜ê°€].get(str(lv), 0)

    st.subheader("2ï¸âƒ£ ì´ ëª¨ë˜ì–‘ ê²°ê³¼")
    st.success(f"ì´ ëª¨ë˜ì–‘: {ì´ëª¨ë˜ì–‘:,}ê°œ")

    í›„ë³´ = []
    for ì¡°í•© in ê³µìƒí•©_ì¡°í•©:
        ì¡°ê±´_ìœ„ë°° = False
        for ëª¨í—˜ê°€, lv in ì‚¬ìš©ì_Lv.items():
            if lv == 0 and ì¡°í•©['ëª¨í—˜ê°€ë“¤'].get(ëª¨í—˜ê°€, 0) > 0:
                ì¡°ê±´_ìœ„ë°° = True
                break
        if ì¡°ê±´_ìœ„ë°°:
            continue
        í›„ë³´.append(ì¡°í•©)

    # 3ë²ˆ: ê°€ì¥ ê³µìƒí•©ì´ ë†’ì€ ì¡°í•©
    ìµœì  = max(í›„ë³´, key=lambda x: x['ê³µìƒí•©']) if í›„ë³´ else None

    if ìµœì :
        st.subheader("3ï¸âƒ£ ì¶”ì²œ ì¡°í•©")
        st.markdown(f"âœ… í•„ìš”í•œ ëª¨ë˜ì–‘: **{ìµœì ['ëª¨ë˜ì†Œëª¨ëŸ‰']:,}ê°œ**")
        headers = "".join([f"<th>{ëª¨í—˜ê°€}</th>" for ëª¨í—˜ê°€ in ìµœì ["ëª¨í—˜ê°€ë“¤"]])
        rows = "".join([f"<td>Lv {lv}</td>" for lv in ìµœì ["ëª¨í—˜ê°€ë“¤"].values()])
        st.markdown(f"""
        <table style='width:100%; text-align:left;'>
            <tr>{headers}</tr>
            <tr>{rows}</tr>
        </table>
        """, unsafe_allow_html=True)

        # 4ë²ˆ: 3ë²ˆë³´ë‹¤ ê³µìƒí•©ì´ ë†’ì€ ì¡°í•© ì¤‘ ëª¨ë˜ì†Œëª¨ëŸ‰ì´ ê°€ì¥ ì ì€ ê²ƒ
        ë”ë†’ì€í›„ë³´ = [x for x in í›„ë³´ if x['ê³µìƒí•©'] > ìµœì ['ê³µìƒí•©']]
        ë‹¤ìŒ = min(ë”ë†’ì€í›„ë³´, key=lambda x: x['ëª¨ë˜ì†Œëª¨ëŸ‰']) if ë”ë†’ì€í›„ë³´ else None

        if ë‹¤ìŒ:
            st.subheader("4ï¸âƒ£ ë‹¤ìŒ ì¶”ì²œ ì¡°í•©")
            st.markdown(f"âœ… í•„ìš”í•œ ëª¨ë˜ì–‘: **{ë‹¤ìŒ['ëª¨ë˜ì†Œëª¨ëŸ‰']:,}ê°œ**")
            headers = "".join([f"<th>{ëª¨í—˜ê°€}</th>" for ëª¨í—˜ê°€ in ë‹¤ìŒ["ëª¨í—˜ê°€ë“¤"]])
            rows = "".join([f"<td>Lv {lv}</td>" for lv in ë‹¤ìŒ["ëª¨í—˜ê°€ë“¤"].values()])
            st.markdown(f"""
            <table style='width:100%; text-align:left;'>
                <tr>{headers}</tr>
                <tr>{rows}</tr>
            </table>
            """, unsafe_allow_html=True)

            st.subheader("5ï¸âƒ£ ğŸ“… ì˜ˆìƒ ì¬ë¶„ë°° ê°€ëŠ¥ ì‹œì ")
            ì¡°ì„_ë‚œì´ë„ = st.number_input("ì¡°ì„ ì†Œíƒ• ë‚œì´ë„ (1 ~ 100)", min_value=1, max_value=100, value=50, step=1)
            ì°¨ì´ = max(0, ë‹¤ìŒ['ëª¨ë˜ì†Œëª¨ëŸ‰'] - ìµœì ['ëª¨ë˜ì†Œëª¨ëŸ‰'])
            if ì¡°ì„_ë‚œì´ë„ > 0:
                ì˜ˆìƒ_ì¼ìˆ˜ = (ì°¨ì´ // (ì¡°ì„_ë‚œì´ë„ * 5)) + (1 if ì°¨ì´ % (ì¡°ì„_ë‚œì´ë„ * 5) > 0 else 0)
                st.success(f"í˜„ì¬ ì¡°ì„ ì†Œíƒ• ë‚œì´ë„ ê¸°ì¤€ìœ¼ë¡œ ì•½ {ì˜ˆìƒ_ì¼ìˆ˜}ì¼ ë’¤ì— ì¬ë¶„ë°° ê°€ëŠ¥í•©ë‹ˆë‹¤.")
